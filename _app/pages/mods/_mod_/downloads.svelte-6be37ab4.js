import{S as ae,i as fe,s as ue,K as $,L as ee,a as D,d as c,b as _,g as W,k as q,l as re,m as A,O as ne,e as E,c as T,f as oe,G as p,t as C,h as N,j as B,w as G,x as K,y as Q,W as ie,q as Z,o as J,B as x,$ as Ce,a0 as Ne,a1 as He,Q as Ue,Z as Ie}from"../../../chunks/vendor-931ae641.js";import{P as We,a as Se}from"../../../chunks/page-section-title-9328492b.js";import{r as Ve}from"../../../chunks/read-from-store-3d1980e1.js";import{L as je}from"../../../chunks/link-button-765b468d.js";import{g as Le}from"../../../chunks/mod-path-name-10fc7192.js";import{m as Ee}from"../../../chunks/store-0b538a3e.js";function pe(i){let e,t,o,l;return{c(){e=$("circle"),this.h()},l(n){e=ee(n,"circle",{cy:!0,cx:!0,r:!0,fill:!0}),D(e).forEach(c),this.h()},h(){_(e,"cy",t=i[3](i[1])),_(e,"cx",o=i[4](i[1])),_(e,"r",l=3),_(e,"fill",i[2])},m(n,s){W(n,e,s)},p(n,s){s&10&&t!==(t=n[3](n[1]))&&_(e,"cy",t),s&18&&o!==(o=n[4](n[1]))&&_(e,"cx",o),s&4&&_(e,"fill",n[2])},d(n){n&&c(e)}}}function qe(i){let e,t,o,l,n=i[1]&&pe(i);return{c(){e=$("polyline"),o=q(),n&&n.c(),l=re(),this.h()},l(s){e=ee(s,"polyline",{fill:!0,class:!0,"stroke-width":!0,stroke:!0,points:!0}),D(e).forEach(c),o=A(s),n&&n.l(s),l=re(),this.h()},h(){_(e,"fill","none"),_(e,"class","opacity-80"),_(e,"stroke-width","1"),_(e,"stroke",i[2]),_(e,"points",t=i[0].map(i[10]).join(" "))},m(s,r){W(s,e,r),W(s,o,r),n&&n.m(s,r),W(s,l,r)},p(s,[r]){r&4&&_(e,"stroke",s[2]),r&25&&t!==(t=s[0].map(s[10]).join(" "))&&_(e,"points",t),s[1]?n?n.p(s,r):(n=pe(s),n.c(),n.m(l.parentNode,l)):n&&(n.d(1),n=null)},i:ne,o:ne,d(s){s&&c(e),s&&c(o),n&&n.d(s),s&&c(l)}}}function Ae(i,e,t){let o,l,{historyPoints:n=[]}=e,{firstPoint:s}=e,{widthMultiplier:r}=e,{minDownloads:a}=e,{heightMuliplier:m}=e,{chartHeight:u}=e,{hoveredPoint:h=null}=e,{color:g}=e;const y=d=>`${o(d)},${l(d)}`;return i.$$set=d=>{"historyPoints"in d&&t(0,n=d.historyPoints),"firstPoint"in d&&t(5,s=d.firstPoint),"widthMultiplier"in d&&t(6,r=d.widthMultiplier),"minDownloads"in d&&t(7,a=d.minDownloads),"heightMuliplier"in d&&t(8,m=d.heightMuliplier),"chartHeight"in d&&t(9,u=d.chartHeight),"hoveredPoint"in d&&t(1,h=d.hoveredPoint),"color"in d&&t(2,g=d.color)},i.$$.update=()=>{i.$$.dirty&96&&t(4,o=d=>(d.UnixTimestamp-s.UnixTimestamp)*r),i.$$.dirty&896&&t(3,l=d=>(d.DownloadCount-a)*m+u)},[n,h,g,l,o,s,r,a,m,u,y]}class ge extends ae{constructor(e){super();fe(this,e,Ae,qe,ue,{historyPoints:0,firstPoint:5,widthMultiplier:6,minDownloads:7,heightMuliplier:8,chartHeight:9,hoveredPoint:1,color:2})}}const Te={DownloadCount:0,UnixTimestamp:0},Be=(i,e)=>{const t=i[i.length-1],o=e[e.length-1];return!t&&o?o:!o&&t?t:o&&t?t.UnixTimestamp<o.UnixTimestamp?t:o:Te},Oe=(i,e)=>{const t=i[0],o=e[0];return!t&&o?o:!o&&t?t:t&&o?t.UnixTimestamp>o.UnixTimestamp?t:o:Te},ve=(i,e,t,o)=>{let l=null;for(const n of i)Math.abs(e-n.UnixTimestamp)*t>o||(!l||Math.abs(e-n.UnixTimestamp)<Math.abs(e-l.UnixTimestamp))&&(l=n);return l},z=i=>new Date(i.UnixTimestamp*1e3).toLocaleDateString(void 0,{day:"2-digit",month:"short",year:"numeric"});function Pe(i){let e,t,o,l,n,s,r=i[3]&&we(i),a=i[4]&&i[1]&&De(i),m=i[3]&&ye(i),u=i[4]&&!i[3]&&Me(i);return{c(){e=E("span"),t=E("div"),r&&r.c(),o=q(),a&&a.c(),l=q(),n=E("div"),m&&m.c(),s=q(),u&&u.c(),this.h()},l(h){e=T(h,"SPAN",{class:!0,style:!0});var g=D(e);t=T(g,"DIV",{class:!0});var y=D(t);r&&r.l(y),o=A(y),a&&a.l(y),y.forEach(c),l=A(g),n=T(g,"DIV",{class:!0});var d=D(n);m&&m.l(d),s=A(d),u&&u.l(d),d.forEach(c),g.forEach(c),this.h()},h(){_(t,"class","justify-center"),_(n,"class","text-light"),_(e,"class","absolute text-center bg-darker bg-opacity-60 p-2 rounded z-10 min-w-max"),oe(e,"left",i[2].x+i[5].x+"px"),oe(e,"top",i[2].y+i[5].y+"px")},m(h,g){W(h,e,g),p(e,t),r&&r.m(t,null),p(t,o),a&&a.m(t,null),p(e,l),p(e,n),m&&m.m(n,null),p(n,s),u&&u.m(n,null)},p(h,g){h[3]?r?r.p(h,g):(r=we(h),r.c(),r.m(t,o)):r&&(r.d(1),r=null),h[4]&&h[1]?a?a.p(h,g):(a=De(h),a.c(),a.m(t,null)):a&&(a.d(1),a=null),h[3]?m?m.p(h,g):(m=ye(h),m.c(),m.m(n,s)):m&&(m.d(1),m=null),h[4]&&!h[3]?u?u.p(h,g):(u=Me(h),u.c(),u.m(n,null)):u&&(u.d(1),u=null),g&4&&oe(e,"left",h[2].x+h[5].x+"px"),g&4&&oe(e,"top",h[2].y+h[5].y+"px")},d(h){h&&c(e),r&&r.d(),a&&a.d(),m&&m.d(),u&&u.d()}}}function we(i){let e,t=i[0].name+"",o,l,n=i[3].DownloadCount+"",s;return{c(){e=E("div"),o=C(t),l=C(": "),s=C(n),this.h()},l(r){e=T(r,"DIV",{class:!0});var a=D(e);o=N(a,t),l=N(a,": "),s=N(a,n),a.forEach(c),this.h()},h(){_(e,"class","text-accent")},m(r,a){W(r,e,a),p(e,o),p(e,l),p(e,s)},p(r,a){a&1&&t!==(t=r[0].name+"")&&B(o,t),a&8&&n!==(n=r[3].DownloadCount+"")&&B(s,n)},d(r){r&&c(e)}}}function De(i){let e,t=i[1].name+"",o,l,n=i[4].DownloadCount+"",s;return{c(){e=E("div"),o=C(t),l=C(": "),s=C(n),this.h()},l(r){e=T(r,"DIV",{class:!0});var a=D(e);o=N(a,t),l=N(a,": "),s=N(a,n),a.forEach(c),this.h()},h(){_(e,"class","text-cta")},m(r,a){W(r,e,a),p(e,o),p(e,l),p(e,s)},p(r,a){a&2&&t!==(t=r[1].name+"")&&B(o,t),a&16&&n!==(n=r[4].DownloadCount+"")&&B(s,n)},d(r){r&&c(e)}}}function ye(i){let e=z(i[3])+"",t;return{c(){t=C(e)},l(o){t=N(o,e)},m(o,l){W(o,t,l)},p(o,l){l&8&&e!==(e=z(o[3])+"")&&B(t,e)},d(o){o&&c(t)}}}function Me(i){let e=z(i[4])+"",t;return{c(){t=C(e)},l(o){t=N(o,e)},m(o,l){W(o,t,l)},p(o,l){l&16&&e!==(e=z(o[4])+"")&&B(t,e)},d(o){o&&c(t)}}}function Re(i){let e,t=(i[3]||i[4])&&Pe(i);return{c(){t&&t.c(),e=re()},l(o){t&&t.l(o),e=re()},m(o,l){t&&t.m(o,l),W(o,e,l)},p(o,[l]){o[3]||o[4]?t?t.p(o,l):(t=Pe(o),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:ne,o:ne,d(o){t&&t.d(o),o&&c(e)}}}function Fe(i,e,t){const o={x:-40,y:30};let{mod:l}=e,{compareWithMod:n}=e,{mousePosition:s={x:0,y:0}}=e,{hoveredPoint:r=null}=e,{hoveredPointCompare:a=null}=e;return i.$$set=m=>{"mod"in m&&t(0,l=m.mod),"compareWithMod"in m&&t(1,n=m.compareWithMod),"mousePosition"in m&&t(2,s=m.mousePosition),"hoveredPoint"in m&&t(3,r=m.hoveredPoint),"hoveredPointCompare"in m&&t(4,a=m.hoveredPointCompare)},[l,n,s,r,a,o]}class Xe extends ae{constructor(e){super();fe(this,e,Fe,Re,ue,{mod:0,compareWithMod:1,mousePosition:2,hoveredPoint:3,hoveredPointCompare:4})}}function ze(i){let e,t,o,l,n,s,r,a,m,u,h,g,y,d,k,H,V,X,U,M,f=z(i[4])+"",P,j,S,I=z(i[5])+"",b,L,Y,me;return u=new Xe({props:{compareWithMod:i[3],mod:i[2],hoveredPoint:i[9],hoveredPointCompare:i[10],mousePosition:i[8]}}),H=new ge({props:{chartHeight:i[13].y,firstPoint:i[4],heightMuliplier:i[12],minDownloads:i[6],widthMultiplier:i[11],historyPoints:i[0],hoveredPoint:i[9],color:"#ffab8a"}}),V=new ge({props:{chartHeight:i[13].y,firstPoint:i[4],heightMuliplier:i[12],minDownloads:i[6],widthMultiplier:i[11],historyPoints:i[1],hoveredPoint:i[10],color:"#35823f"}}),{c(){e=E("div"),t=E("div"),o=E("div"),l=E("span"),n=C(i[7]),s=E("span"),r=C(i[6]),a=q(),m=E("div"),G(u.$$.fragment),h=q(),g=$("svg"),y=$("g"),d=$("line"),k=$("line"),G(H.$$.fragment),G(V.$$.fragment),X=q(),U=E("div"),M=E("span"),P=C(f),j=q(),S=E("span"),b=C(I),this.h()},l(v){e=T(v,"DIV",{class:!0});var w=D(e);t=T(w,"DIV",{class:!0});var O=D(t);o=T(O,"DIV",{class:!0,style:!0});var R=D(o);l=T(R,"SPAN",{});var F=D(l);n=N(F,i[7]),F.forEach(c),s=T(R,"SPAN",{});var he=D(s);r=N(he,i[6]),he.forEach(c),R.forEach(c),a=A(O),m=T(O,"DIV",{class:!0});var le=D(m);K(u.$$.fragment,le),h=A(le),g=ee(le,"svg",{viewBox:!0,class:!0});var de=D(g);y=ee(de,"g",{class:!0});var te=D(y);d=ee(te,"line",{class:!0,"stroke-width":!0,x1:!0,y1:!0,x2:!0,y2:!0}),D(d).forEach(c),k=ee(te,"line",{class:!0,"stroke-width":!0,x1:!0,y1:!0,x2:!0,y2:!0}),D(k).forEach(c),K(H.$$.fragment,te),K(V.$$.fragment,te),te.forEach(c),de.forEach(c),le.forEach(c),O.forEach(c),X=A(w),U=T(w,"DIV",{class:!0});var se=D(U);M=T(se,"SPAN",{});var ce=D(M);P=N(ce,f),ce.forEach(c),j=A(se),S=T(se,"SPAN",{class:!0});var _e=D(S);b=N(_e,I),_e.forEach(c),se.forEach(c),w.forEach(c),this.h()},h(){_(o,"class","flex flex-col justify-between text-right"),oe(o,"line-height","0"),_(d,"class","stroke-light opacity-80"),_(d,"stroke-width","1"),_(d,"x1","0"),_(d,"y1","100%"),_(d,"x2","0"),_(d,"y2","0"),_(k,"class","stroke-light opacity-80"),_(k,"stroke-width","1"),_(k,"x1","0"),_(k,"y1","100%"),_(k,"x2","100%"),_(k,"y2","100%"),_(y,"class","pointer-events-none"),_(g,"viewBox","0 0 "+i[13].x+" "+i[13].y),_(g,"class","block overflow-visible"),_(m,"class","relative flex-1"),_(t,"class","flex gap-4"),_(S,"class","float-right"),_(U,"class","mt-2"),_(e,"class","bg-dark p-4 rounded text-sm")},m(v,w){W(v,e,w),p(e,t),p(t,o),p(o,l),p(l,n),p(o,s),p(s,r),p(t,a),p(t,m),Q(u,m,null),p(m,h),p(m,g),p(g,y),p(y,d),p(y,k),Q(H,y,null),Q(V,y,null),p(e,X),p(e,U),p(U,M),p(M,P),p(U,j),p(U,S),p(S,b),L=!0,Y||(me=[ie(g,"mousemove",i[15]),ie(g,"focus",i[16]),ie(g,"mouseout",i[14]),ie(g,"blur",i[14])],Y=!0)},p(v,[w]){(!L||w&128)&&B(n,v[7]),(!L||w&64)&&B(r,v[6]);const O={};w&8&&(O.compareWithMod=v[3]),w&4&&(O.mod=v[2]),w&512&&(O.hoveredPoint=v[9]),w&1024&&(O.hoveredPointCompare=v[10]),w&256&&(O.mousePosition=v[8]),u.$set(O);const R={};w&16&&(R.firstPoint=v[4]),w&4096&&(R.heightMuliplier=v[12]),w&64&&(R.minDownloads=v[6]),w&2048&&(R.widthMultiplier=v[11]),w&1&&(R.historyPoints=v[0]),w&512&&(R.hoveredPoint=v[9]),H.$set(R);const F={};w&16&&(F.firstPoint=v[4]),w&4096&&(F.heightMuliplier=v[12]),w&64&&(F.minDownloads=v[6]),w&2048&&(F.widthMultiplier=v[11]),w&2&&(F.historyPoints=v[1]),w&1024&&(F.hoveredPoint=v[10]),V.$set(F),(!L||w&16)&&f!==(f=z(v[4])+"")&&B(P,f),(!L||w&32)&&I!==(I=z(v[5])+"")&&B(b,I)},i(v){L||(Z(u.$$.fragment,v),Z(H.$$.fragment,v),Z(V.$$.fragment,v),L=!0)},o(v){J(u.$$.fragment,v),J(H.$$.fragment,v),J(V.$$.fragment,v),L=!1},d(v){v&&c(e),x(u),x(H),x(V),Y=!1,Ce(me)}}}function Ye(i,e,t){let o,l,n,s,r,a,{historyPoints:m=[]}=e,{comparePoints:u=[]}=e,{mod:h}=e,{compareWithMod:g}=e;const y={y:100,x:500};let d={x:0,y:0},k=null,H=null;const V=(f,P,j)=>{const S=f/j;t(8,d={x:f,y:P});const I=o.UnixTimestamp+S*(l.UnixTimestamp-o.UnixTimestamp);t(9,k=ve(m,I,r,y.x/100)),t(10,H=ve(u,I,r,y.x/100))},X=()=>{t(9,k=null),t(10,H=null)},U=f=>{V(f.offsetX,f.offsetY,f.currentTarget.getBoundingClientRect().width)},M=f=>{const P=f.currentTarget.getBoundingClientRect();V(P.width/2,P.height/2,P.width)};return i.$$set=f=>{"historyPoints"in f&&t(0,m=f.historyPoints),"comparePoints"in f&&t(1,u=f.comparePoints),"mod"in f&&t(2,h=f.mod),"compareWithMod"in f&&t(3,g=f.compareWithMod)},i.$$.update=()=>{i.$$.dirty&3&&t(4,o=Be(m,u)),i.$$.dirty&3&&t(5,l=Oe(m,u)),i.$$.dirty&3&&t(7,s=Ne(He([...m,...u],"DownloadCount"))||0),i.$$.dirty&48&&t(11,r=y.x/(l.UnixTimestamp-o.UnixTimestamp)),i.$$.dirty&192&&t(12,a=-y.y/(s-n))},t(6,n=0),[m,u,h,g,o,l,n,s,d,k,H,r,a,y,X,U,M]}class Ge extends ae{constructor(e){super();fe(this,e,Ye,ze,ue,{historyPoints:0,comparePoints:1,mod:2,compareWithMod:3})}}function ke(i,e,t){const o=i.slice();return o[1]=e[t],o}function Ke(i){let e,t=i[1].name+"",o;return{c(){e=C("\u2039 Back to "),o=C(t)},l(l){e=N(l,"\u2039 Back to "),o=N(l,t)},m(l,n){W(l,e,n),W(l,o,n)},p(l,n){n&2&&t!==(t=l[1].name+"")&&B(o,t)},d(l){l&&c(e),l&&c(o)}}}function Qe(i){let e=i[1].name+"",t,o;return{c(){t=C(e),o=C(" downloads over time")},l(l){t=N(l,e),o=N(l," downloads over time")},m(l,n){W(l,t,n),W(l,o,n)},p(l,n){n&2&&e!==(e=l[1].name+"")&&B(t,e)},d(l){l&&c(t),l&&c(o)}}}function be(i){let e,t=i[1].name+"",o,l;return{c(){e=E("option"),o=C(t),this.h()},l(n){e=T(n,"OPTION",{});var s=D(e);o=N(s,t),s.forEach(c),this.h()},h(){e.__value=l=i[1].uniqueName,e.value=e.__value},m(n,s){W(n,e,s),p(e,o)},p:ne,d(n){n&&c(e)}}}function Ze(i){let e,t,o,l,n,s,r,a,m,u,h,g,y,d,k,H,V,X;o=new je({props:{href:"..",isSmall:!0,$$slots:{default:[Ke]},$$scope:{ctx:i}}}),n=new Se({props:{id:"downloads",$$slots:{default:[Qe]},$$scope:{ctx:i}}});let U=i[4],M=[];for(let f=0;f<U.length;f+=1)M[f]=be(ke(i,U,f));return k=new Ge({props:{historyPoints:i[0],comparePoints:i[3],mod:i[1],compareWithMod:i[2]}}),{c(){e=E("div"),t=E("div"),G(o.$$.fragment),l=q(),G(n.$$.fragment),s=q(),r=E("div"),a=E("span"),m=C("Compare with:"),u=q(),h=E("select"),g=E("option"),y=C("None");for(let f=0;f<M.length;f+=1)M[f].c();d=q(),G(k.$$.fragment),this.h()},l(f){e=T(f,"DIV",{});var P=D(e);t=T(P,"DIV",{class:!0});var j=D(t);K(o.$$.fragment,j),j.forEach(c),l=A(P),K(n.$$.fragment,P),s=A(P),r=T(P,"DIV",{class:!0});var S=D(r);a=T(S,"SPAN",{});var I=D(a);m=N(I,"Compare with:"),I.forEach(c),u=A(S),h=T(S,"SELECT",{class:!0});var b=D(h);g=T(b,"OPTION",{});var L=D(g);y=N(L,"None"),L.forEach(c);for(let Y=0;Y<M.length;Y+=1)M[Y].l(b);b.forEach(c),S.forEach(c),d=A(P),K(k.$$.fragment,P),P.forEach(c),this.h()},h(){_(t,"class","flex mb-4"),g.__value=null,g.value=g.__value,_(h,"class","select"),_(r,"class","flex gap-4")},m(f,P){W(f,e,P),p(e,t),Q(o,t,null),p(e,l),Q(n,e,null),p(e,s),p(e,r),p(r,a),p(a,m),p(r,u),p(r,h),p(h,g),p(g,y);for(let j=0;j<M.length;j+=1)M[j].m(h,null);p(e,d),Q(k,e,null),H=!0,V||(X=ie(h,"change",i[5]),V=!0)},p(f,P){const j={};P&514&&(j.$$scope={dirty:P,ctx:f}),o.$set(j);const S={};if(P&514&&(S.$$scope={dirty:P,ctx:f}),n.$set(S),P&16){U=f[4];let b;for(b=0;b<U.length;b+=1){const L=ke(f,U,b);M[b]?M[b].p(L,P):(M[b]=be(L),M[b].c(),M[b].m(h,null))}for(;b<M.length;b+=1)M[b].d(1);M.length=U.length}const I={};P&1&&(I.historyPoints=f[0]),P&8&&(I.comparePoints=f[3]),P&2&&(I.mod=f[1]),P&4&&(I.compareWithMod=f[2]),k.$set(I)},i(f){H||(Z(o.$$.fragment,f),Z(n.$$.fragment,f),Z(k.$$.fragment,f),H=!0)},o(f){J(o.$$.fragment,f),J(n.$$.fragment,f),J(k.$$.fragment,f),H=!1},d(f){f&&c(e),x(o),x(n),Ie(M,f),x(k),V=!1,X()}}}function Je(i){let e,t;return e=new We({props:{$$slots:{default:[Ze]},$$scope:{ctx:i}}}),{c(){G(e.$$.fragment)},l(o){K(e.$$.fragment,o)},m(o,l){Q(e,o,l),t=!0},p(o,[l]){const n={};l&527&&(n.$$scope={dirty:l,ctx:o}),e.$set(n)},i(o){t||(Z(e.$$.fragment,o),t=!0)},o(o){J(e.$$.fragment,o),t=!1},d(o){x(e,o)}}}const lt=!0,st=async({fetch:i,params:e})=>{const o=(await Ve(Ee)).find(({name:s})=>e.mod===Le(s));if(!o)return{status:404,error:new Error(`Could not find mod ${e.mod}`)};const l=await i(`/api/${o.uniqueName}/downloads.json`);return l.status!==200?(console.error(`Failed to get mod download history from local API: ${l.status}. ${l.statusText}`),{props:{modDownloadHistory:[],mod:o}}):{props:{modDownloadHistory:await l.json(),mod:o}}};function xe(i,e,t){let o;Ue(i,Ee,u=>t(6,o=u));let{modDownloadHistory:l=[]}=e,{mod:n}=e,s=null,r=[];const a=o.filter(({uniqueName:u})=>u!==n.uniqueName),m=u=>{t(2,s=a.find(h=>h.uniqueName===u.currentTarget.value)||null)};return i.$$set=u=>{"modDownloadHistory"in u&&t(0,l=u.modDownloadHistory),"mod"in u&&t(1,n=u.mod)},i.$$.update=()=>{i.$$.dirty&4&&(async()=>{if(s){const u=await fetch(`/api/${s.uniqueName}/downloads.json`);u.ok&&t(3,r=await u.json())}else t(3,r=[])})()},[l,n,s,r,a,m]}class rt extends ae{constructor(e){super();fe(this,e,xe,Je,ue,{modDownloadHistory:0,mod:1})}}export{rt as default,st as load,lt as prerender};
